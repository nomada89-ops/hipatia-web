(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4754:function(e,a,s){Promise.resolve().then(s.bind(s,7340))},7340:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return v}});var t=s(7437),l=s(2265),r=s(1436),i=s(7031),d=s(6940),n=s(7059),c=s(2994),o=s(8155),x=s(999),h=s(6810),m=s(62),u=s(407),j=s(3250),g=s(5466),f=s(5929),p=s(8736),b=s(5805),y=s(6865);function v(){let[e,a]=(0,l.useState)([]),[s,v]=(0,l.useState)(!0),[N,w]=(0,l.useState)(null);if((0,l.useEffect)(()=>{(async function(){try{let e=await fetch("/api/data");if(!e.ok)throw Error("Failed to fetch data");let s=await e.json();if(s.error)throw Error(s.details||s.error);a(s)}catch(e){w(e instanceof Error?e.message:"Unknown error")}finally{v(!1)}})()},[]),s)return(0,t.jsx)("div",{className:"flex h-screen items-center justify-center text-lg font-medium text-gray-500",children:"Cargando datos..."});if(N)return(0,t.jsxs)("div",{className:"flex h-screen items-center justify-center text-red-500",children:["Error: ",N]});let F=e.length,_={};e.forEach(e=>{let a=e.student_course;a&&(_[a]=(_[a]||0)+1)});let E="N/A",C=0;Object.entries(_).forEach(e=>{let[a,s]=e;s>C&&(C=s,E=a)});let S=e.filter(e=>{var a;let s=(null===(a=e.gravedad)||void 0===a?void 0:a.toLowerCase())||"";return s.includes("grave")||s.includes("muy grave")}).length,k=F>0?(S/F*100).toFixed(1):"0",D=Object.entries(_).map(e=>{let[a,s]=e;return{name:a,value:s}}).sort((e,a)=>a.value-e.value),K={};e.forEach(e=>{let a=e.gravedad;a&&"undefined"!==a&&""!==a.trim()&&(K[a]=(K[a]||0)+1)});let B=Object.entries(K).map(e=>{let[a,s]=e;return{name:a,value:s}}),I=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d"],R={};e.forEach(e=>{let a=e.fecha_incidente,s=new Date(e.fecha_incidente);isNaN(s.getTime())||(a="".concat(s.getFullYear(),"-").concat(String(s.getMonth()+1).padStart(2,"0"))),R[a]=(R[a]||0)+1});let z=Object.entries(R).map(e=>{let[a,s]=e;return{name:a,value:s}}).sort((e,a)=>e.name.localeCompare(a.name)),O={};e.forEach(e=>{let a=e.hora_incidente;a||e.Fecha_Falta,a&&(O[a]=(O[a]||0)+1)});let A=Object.entries(O).map(e=>{let[a,s]=e;return{name:a,value:s}}).sort((e,a)=>e.name.localeCompare(a.name)),G={};e.forEach(e=>{let a=e.contacto_familia||"No registrado";G[a]=(G[a]||0)+1});let Z=Object.entries(G).map(e=>{let[a,s]=e;return{name:a,value:s}}),q=["#3B82F6","#EF4444","#10B981"],L={};e.forEach(e=>{let a=e.articulo_aplicado;a&&(L[a]=(L[a]||0)+1)});let Q=Object.entries(L).map(e=>{let[a,s]=e;return{name:a,value:s}}).sort((e,a)=>a.value-e.value).slice(0,5);return(0,t.jsxs)("main",{className:"min-h-screen bg-gray-50 p-8 font-sans",children:[(0,t.jsxs)("header",{className:"mb-8 flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[(0,t.jsx)(g.Z,{className:"text-blue-600"}),"Dashboard de Convivencia"]}),(0,t.jsx)("p",{className:"text-gray-500 mt-1",children:"Visi\xf3n general de incidencias escolares - Registro de Sanciones"})]}),(0,t.jsxs)("a",{href:"/solar",className:"flex items-center gap-2 px-4 py-2 bg-yellow-500 hover:bg-yellow-600 text-white rounded-lg font-medium transition-colors shadow-sm",children:[(0,t.jsx)(f.Z,{className:"h-5 w-5"}),"Panel Solar"]})]}),(0,t.jsxs)("div",{className:"mb-8 grid grid-cols-1 gap-6 md:grid-cols-3",children:[(0,t.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm border-l-4 border-blue-500",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Total Incidencias"}),(0,t.jsx)("div",{className:"rounded-full bg-blue-100 p-2 text-blue-600",children:(0,t.jsx)(p.Z,{size:20})})]}),(0,t.jsx)("p",{className:"mt-4 text-3xl font-bold text-gray-900",children:F})]}),(0,t.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm border-l-4 border-orange-500",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Curso m\xe1s Conflictivo"}),(0,t.jsx)("div",{className:"rounded-full bg-orange-100 p-2 text-orange-600",children:(0,t.jsx)(b.Z,{size:20})})]}),(0,t.jsx)("p",{className:"mt-4 text-3xl font-bold text-gray-900",children:E}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:[C," incidencias"]})]}),(0,t.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm border-l-4 border-red-500",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Gravedad (G/MG)"}),(0,t.jsx)("div",{className:"rounded-full bg-red-100 p-2 text-red-600",children:(0,t.jsx)(y.Z,{size:20})})]}),(0,t.jsxs)("p",{className:"mt-4 text-3xl font-bold text-gray-900",children:[k,"%"]}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"del total"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-8 lg:grid-cols-2 mb-8",children:[(0,t.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm",children:[(0,t.jsx)("h2",{className:"mb-6 text-lg font-bold text-gray-900",children:"Incidencias por Curso"}),(0,t.jsx)("div",{className:"h-80 w-full",children:(0,t.jsx)(r.h,{width:"100%",height:"100%",children:(0,t.jsxs)(i.v,{data:D,layout:"vertical",margin:{top:5,right:30,left:40,bottom:5},children:[(0,t.jsx)(d.q,{strokeDasharray:"3 3",horizontal:!0,vertical:!1}),(0,t.jsx)(n.K,{type:"number",hide:!0}),(0,t.jsx)(c.B,{dataKey:"name",type:"category",width:50,tick:{fontSize:12}}),(0,t.jsx)(o.u,{cursor:{fill:"#f3f4f6"},contentStyle:{borderRadius:"0.5rem"}}),(0,t.jsx)(x.$Q,{dataKey:"value",fill:"#3B82F6",radius:[0,4,4,0],name:"Incidencias"})]})})})]}),(0,t.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm",children:[(0,t.jsx)("h2",{className:"mb-6 text-lg font-bold text-gray-900",children:"Distribuci\xf3n por Gravedad"}),(0,t.jsx)("div",{className:"h-80 w-full",children:(0,t.jsx)(r.h,{width:"100%",height:"100%",children:(0,t.jsxs)(h.u,{children:[(0,t.jsx)(m.by,{data:B,cx:"50%",cy:"50%",labelLine:!1,outerRadius:80,fill:"#8884d8",dataKey:"value",label:e=>{let{percent:a}=e;return"".concat((100*(a||0)).toFixed(0),"%")},children:B.map((e,a)=>(0,t.jsx)(u.b,{fill:I[a%I.length]},"cell-".concat(a)))}),(0,t.jsx)(o.u,{contentStyle:{borderRadius:"0.5rem"}}),(0,t.jsx)(j.D,{})]})})})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-8 lg:grid-cols-2 mb-8",children:[(0,t.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm",children:[(0,t.jsx)("h2",{className:"mb-6 text-lg font-bold text-gray-900",children:"Hora del Incidente"}),(0,t.jsx)("div",{className:"h-80 w-full",children:(0,t.jsx)(r.h,{width:"100%",height:"100%",children:(0,t.jsxs)(i.v,{data:A,margin:{top:10,right:30,left:0,bottom:0},children:[(0,t.jsx)(d.q,{strokeDasharray:"3 3",vertical:!1}),(0,t.jsx)(n.K,{dataKey:"name",tick:{fontSize:12}}),(0,t.jsx)(c.B,{allowDecimals:!1}),(0,t.jsx)(o.u,{cursor:{fill:"#f3f4f6"},contentStyle:{borderRadius:"0.5rem"}}),(0,t.jsx)(x.$Q,{dataKey:"value",fill:"#8B5CF6",radius:[4,4,0,0],name:"Incidencias"})]})})})]}),(0,t.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm",children:[(0,t.jsx)("h2",{className:"mb-6 text-lg font-bold text-gray-900",children:"Contacto con Familia"}),(0,t.jsx)("div",{className:"h-80 w-full",children:(0,t.jsx)(r.h,{width:"100%",height:"100%",children:(0,t.jsxs)(h.u,{children:[(0,t.jsx)(m.by,{data:Z,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,fill:"#8884d8",paddingAngle:5,dataKey:"value",label:e=>{let{name:a,percent:s}=e;return"".concat(a||""," ").concat((s?100*s:0).toFixed(0),"%")},children:Z.map((e,a)=>(0,t.jsx)(u.b,{fill:q[a%q.length]},"cell-".concat(a)))}),(0,t.jsx)(o.u,{contentStyle:{borderRadius:"0.5rem"}}),(0,t.jsx)(j.D,{})]})})})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-8 mb-8",children:[(0,t.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm",children:[(0,t.jsx)("h2",{className:"mb-6 text-lg font-bold text-gray-900",children:"Top 5 Art\xedculos Infringidos"}),(0,t.jsx)("div",{className:"h-80 w-full",children:(0,t.jsx)(r.h,{width:"100%",height:"100%",children:(0,t.jsxs)(i.v,{data:Q,layout:"vertical",margin:{top:5,right:30,left:100,bottom:5},children:[(0,t.jsx)(d.q,{strokeDasharray:"3 3",horizontal:!0,vertical:!1}),(0,t.jsx)(n.K,{type:"number",allowDecimals:!1}),(0,t.jsx)(c.B,{dataKey:"name",type:"category",width:150,tick:{fontSize:11}}),(0,t.jsx)(o.u,{cursor:{fill:"#f3f4f6"},contentStyle:{borderRadius:"0.5rem"}}),(0,t.jsx)(x.$Q,{dataKey:"value",fill:"#EC4899",radius:[0,4,4,0],name:"Incidencias"})]})})})]}),(0,t.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm",children:[(0,t.jsx)("h2",{className:"mb-6 text-lg font-bold text-gray-900",children:"Evoluci\xf3n Temporal"}),(0,t.jsx)("div",{className:"h-80 w-full",children:(0,t.jsx)(r.h,{width:"100%",height:"100%",children:(0,t.jsxs)(i.v,{data:z,margin:{top:10,right:30,left:0,bottom:0},children:[(0,t.jsx)(d.q,{strokeDasharray:"3 3",vertical:!1}),(0,t.jsx)(n.K,{dataKey:"name",tick:{fontSize:12}}),(0,t.jsx)(c.B,{allowDecimals:!1}),(0,t.jsx)(o.u,{cursor:{fill:"#f3f4f6"},contentStyle:{borderRadius:"0.5rem"}}),(0,t.jsx)(x.$Q,{dataKey:"value",fill:"#10B981",radius:[4,4,0,0],name:"Incidencias"})]})})})]})]}),(0,t.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm overflow-hidden",children:[(0,t.jsx)("h2",{className:"mb-6 text-lg font-bold text-gray-900",children:"Detalle de Incidencias"}),(0,t.jsxs)("div",{className:"overflow-x-auto",children:[(0,t.jsxs)("table",{className:"w-full text-left text-sm text-gray-500",children:[(0,t.jsx)("thead",{className:"bg-gray-50 text-xs uppercase text-gray-700",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-3",children:"Fecha"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"Hora"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"Curso"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"Alumno (ID)"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"Gravedad"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"Art\xedculo"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"Fam."})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-gray-200",children:e.map((e,a)=>{var s,l;return(0,t.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,t.jsx)("td",{className:"whitespace-nowrap px-6 py-4",children:e.fecha_incidente||e.Fecha_Falta}),(0,t.jsx)("td",{className:"whitespace-nowrap px-6 py-4",children:e.hora_incidente||"-"}),(0,t.jsx)("td",{className:"whitespace-nowrap px-6 py-4 font-medium text-gray-900",children:e.student_course}),(0,t.jsx)("td",{className:"whitespace-nowrap px-6 py-4",children:e.student_id}),(0,t.jsx)("td",{className:"whitespace-nowrap px-6 py-4",children:(0,t.jsx)("span",{className:"inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium\n                        ".concat((null===(s=e.gravedad)||void 0===s?void 0:s.toLowerCase().includes("muy grave"))?"bg-red-100 text-red-800":(null===(l=e.gravedad)||void 0===l?void 0:l.toLowerCase().includes("grave"))?"bg-orange-100 text-orange-800":"bg-green-100 text-green-800"),children:e.gravedad||"N/A"})}),(0,t.jsx)("td",{className:"px-6 py-4 max-w-xs truncate",title:e.articulo_aplicado,children:e.articulo_aplicado||"-"}),(0,t.jsx)("td",{className:"whitespace-nowrap px-6 py-4",children:e.contacto_familia})]},a)})})]}),0===e.length&&(0,t.jsx)("div",{className:"p-8 text-center text-gray-400",children:"No hay datos para mostrar"})]})]})]})}}},function(e){e.O(0,[688,76,971,117,744],function(){return e(e.s=4754)}),_N_E=e.O()}]);